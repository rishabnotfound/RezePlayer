<!DOCTYPE html>
<html lang="en" dir="ltr" data-full>
<head>
  <meta charset="utf-8" />
  <link rel="icon" href="/logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="RezePlayer Test" />
  <title>RezePlayer Testing</title>

  <!-- <link rel="stylesheet" href="./dist/assets/style.css"> -->

</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>

  <script type="module">
    import { make } from './src/rezeplayer.tsx';

    // Initialize RezePlayer with ALL servers from server.ts
    // User can switch between servers in the Sources menu
    const player = make('#root', {
      title: 'RezePlayer',
      servers: [
        {
          name: 'HLS Sample',
          url: 'https://rezeplayer.vercel.app/reze/hls/master.m3u8',
          type: 'hls'
        },
        {
          name: 'MP4 Sample',
          url: 'https://rezeplayer.vercel.app/reze/mp4/trailer.mp4',
          type: 'mp4'
        }
      ],
      subtitles: [
        {
          name: 'Japanese',
          flagsapi: 'https://flagsapi.com/JP/flat/64.png',
          src: 'https://rezeplayer.vercel.app/reze/subs/ja.vtt',
          default: true
        },
        {
          name: 'English',
          flagsapi: 'https://flagsapi.com/US/flat/64.png',
          src: 'https://rezeplayer.vercel.app/reze/subs/eng.vtt',
        },
        {
          name: 'French',
          flagsapi: 'https://flagsapi.com/FR/flat/64.png',
          src: 'https://rezeplayer.vercel.app/reze/subs/french.vtt',
        },
        {
          name: 'Russian',
          flagsapi: 'https://flagsapi.com/RU/flat/64.png',
          src: 'https://rezeplayer.vercel.app/reze/subs/russian.vtt',
        },
        {
          name: 'Korean',
          flagsapi: 'https://flagsapi.com/KP/flat/64.png',
          src: 'https://rezeplayer.vercel.app/reze/subs/koreon.vtt',
        },
        {
          name: 'Chinese',
          flagsapi: 'https://flagsapi.com/CN/flat/64.png',
          src: 'https://rezeplayer.vercel.app/reze/subs/chinese.vtt',
        },
        {
          name: 'Arabic',
          flagsapi: 'https://flagsapi.com/SA/flat/64.png',
          src: 'https://rezeplayer.vercel.app/reze/subs/arabic.vtt',
        }
      ],
      posterUrl: 'https://rezeplayer.vercel.app/reze/poster.png',
      autoPlay: false,
      volume: 1,
      startTime: 0,
      enableWatchParty: true,
      enableCast: true,
      thumbsGenerate: true, //default true
      themeSettings: true, //default true
      //themeColor: 'e01621',
      thumbsInterval: 10000, // 10 seconds
    });

    // Time tracking - Log every 1 second to avoid spam
    let lastLogTime = 0;
    player.on('timeupdate', ({ currentTime, duration }) => {
      // Only log once per second
      if (Math.floor(currentTime) !== lastLogTime) {
        lastLogTime = Math.floor(currentTime);
        const progress = (currentTime / duration) * 100;
        console.log(`[RezePlayer Time Tracking]`);
        console.log(`  Current Time: ${formatTime(currentTime)}`);
        console.log(`  Duration: ${formatTime(duration)}`);
        console.log(`  Progress: ${progress.toFixed(2)}%`);
      }
    });

    // Log when duration changes (video loaded)
    player.on('durationchange', ({ currentTime, duration }) => {
      console.log(`[RezePlayer Duration Change]`);
      console.log(`  Video Duration: ${formatTime(duration)}`);
      console.log(`  Current Time: ${formatTime(currentTime)}`);
    });

    // Helper function to format time as MM:SS
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Also expose player to window for manual testing in console
    window.player = player;
    console.log('[RezePlayer] Player instance available at window.player');
    console.log('[RezePlayer] Try: player.getCurrentTime(), player.getDuration(), player.seek(30)');
  </script>
</body>
</html>
